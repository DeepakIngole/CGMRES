# Introduction
This code provides the continuation/GMRES method (C/GMRES method) based solvers for nonlinear model predictive control (NMPC). 

- The original C/GMRES method (single shooting)
- The multiple shooting based C/GMRES method
- The multiple shooting based C/GMRES method with condensing of variables with respect to the constraints of the saturation function on the control input

An automatic code generation for NMPC is also provided by codeGen/codeGenforNMPC.ipynb.


# Requirement
- C++11
- Cmake
- Eigen 3
- Python3, numpy, seaborn (for plotsim.py, 2linkanimation.py)
- ffmpeg (to save animations generated by 2linkanimation.py)
- Python 3.6.x, Sympy, Jupyter Notebook (for codeGen/codeGenforNMPC.ipynb)

# Usage
First, set the parameters of your model of NMPC in nmpc_model.hpp, write equations in nmpc_model.cpp, and set simulation conditions in main.cpp. Note that you can generate nmpc_model.hpp nmpc_model.cpp using codeGenforNMPC.ipynb in codeGen. Next, build files as follows:

```
$ mkdir build
$ cd build
$ cmake ..
$ make
```


After performing a numerical simulation, you can see graphs by

```
$ python3 plotsim.py example
```

save graphs by

```
$ python3 plotsim.py example save example
```

see an animation of 2link robot by

```
$ python3 2linkanimation.py example
```

and save its animation by

```
$ python3 2linkanimation.py example save example
```

# Demo
### The multiple shooting based C/GMRES method for a pendubot
![pendubot_multiple_shooting_gif](https://raw.githubusercontent.com/wiki/mayataka/CGMRES/images/fps=20.gif)
![pendubot_multiple_shooting_png](https://raw.github.com/wiki/mayataka/CGMRES/images/pendubot_multiple_shooting.png)


# References
1. [T. Ohtsuka A continuation/GMRES method for fast computation of nonlinear receding horizon control, Automatica, Vol. 40, No. 4, pp. 563-574 (2004)](https://doi.org/10.1016/j.automatica.2003.11.005)
2. [C. T. Kelly, Iterative methods for linear and nonlinear equations, Frontiers in Apllied Mathematics, SIAM (1995)](https://doi.org/10.1137/1.9781611970944)
3. [Y. Shimizu, T. Ohtsuka, M. Diehl, A real‚Äêtime algorithm for nonlinear receding horizon control using multiple shooting and continuation/Krylov method, International Journal of Robust and Nonlinear Control, Vol. 19, No. 8, pp. 919-936 (2008)](https://doi.org/10.1002/rnc.1363)